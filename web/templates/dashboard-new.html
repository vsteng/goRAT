<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Panel - Dashboard</title>
    <link rel="stylesheet" href="/assets/css/dashboard-new.css">
</head>
<body>
    <div class="layout">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>üñ•Ô∏è RAT</h1>
                <p>Control Panel</p>
            </div>

            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showSection('dashboard')"><span>üìä</span> <span>Dashboard</span></a></li>
                <li><a href="#" onclick="showSection('clients')"><span>üë•</span> <span>Clients</span></a></li>
                <li><a href="#" onclick="showSection('proxy')"><span>üåê</span> <span>Proxy</span></a></li>
                <li><a href="#" onclick="showSection('users')"><span>üë§</span> <span>Users</span></a></li>
                <li><a href="#" onclick="showSection('settings')"><span>‚öôÔ∏è</span> <span>Settings</span></a></li>
            </ul>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div class="user-details">
                        <p style="font-weight: 600;">Admin</p>
                        <p>Connected</p>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- TOP BAR -->
            <div class="top-bar">
                <div>
                    <h2 id="pageTitle">Dashboard</h2>
                </div>
                <div class="status-cluster" aria-live="polite">
                    <div class="status-pill">
                        <span class="status-dot healthy" id="healthDot"></span>
                        <div>
                            <div class="pill-label">Health</div>
                            <strong id="healthLabel">--</strong>
                        </div>
                    </div>
                    <div class="status-pill">
                        <span class="status-dot" id="clientsDot"></span>
                        <div>
                            <div class="pill-label">Clients</div>
                            <strong id="clientsSummary">0 online</strong>
                        </div>
                    </div>
                    <div class="status-pill">
                        <span class="status-dot" id="uptimeDot"></span>
                        <div>
                            <div class="pill-label">Uptime</div>
                            <strong id="uptimeLabel">--</strong>
                        </div>
                    </div>
                </div>
                <div class="top-bar-actions">
                    <button class="btn btn-secondary" onclick="loadClients()">üîÑ Refresh</button>
                    <button class="btn btn-primary" onclick="openClientDetailsModal()">‚ûï Add Client</button>
                </div>
            </div>

            <!-- CONTENT -->
            <div class="content">
                <!-- DASHBOARD TAB -->
                <div class="content-section active" id="dashboardSection">
                    <div class="stats-grid">
                        <div class="stat-card" onclick="showSection('clients')">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-label">Total Clients</div>
                            <div class="stat-value" id="totalClients">0</div>
                        </div>
                        <div class="stat-card success" onclick="showSection('clients')">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-label">Online Now</div>
                            <div class="stat-value" id="onlineClients">0</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-icon">‚ö†Ô∏è</div>
                            <div class="stat-label">Offline</div>
                            <div class="stat-value" id="offlineClients">0</div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-icon">üåê</div>
                            <div class="stat-label">Active Proxies</div>
                            <div class="stat-value" id="activeProxies">0</div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>üìä System Overview</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="padding: 20px; background: var(--light); border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--text-light); margin-bottom: 5px;">Server Uptime</div>
                                <div style="font-size: 24px; font-weight: 600; color: var(--primary);" id="serverUptime">--</div>
                            </div>
                            <div style="padding: 20px; background: var(--light); border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--text-light); margin-bottom: 5px;">Total Connections</div>
                                <div style="font-size: 24px; font-weight: 600; color: var(--success);" id="totalConnections">0</div>
                            </div>
                            <div style="padding: 20px; background: var(--light); border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--text-light); margin-bottom: 5px;">Last Activity</div>
                                <div style="font-size: 24px; font-weight: 600; color: var(--info);" id="lastActivity">--</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>üìà Recent Activity</h3>
                        <div id="activityFeed" style="font-size: 13px; color: var(--text-light); line-height: 2;">
                            <p>‚Ä¢ System initialized</p>
                            <p>‚Ä¢ Server listening on port 8080</p>
                            <p>‚Ä¢ Ready for client connections</p>
                        </div>
                    </div>
                </div>

                <!-- CLIENTS TAB -->
                <div class="content-section" id="clientsSection">
                    <div class="clients-layout">
                        <!-- LEFT COLUMN: Client List -->
                        <div class="clients-left">
                            <h3>üë• Clients</h3>
                            <div style="margin-bottom: 12px;">
                                <input type="text" id="clientSearchInput" placeholder="üîç Search by alias, IP, hostname..." 
                                    style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;"
                                    oninput="updateSearch(this.value)">
                            </div>
                            <div class="filter-tabs">
                                <button class="filter-tab active" onclick="filterClients('all')">All</button>
                                <button class="filter-tab" onclick="filterClients('online')">Online</button>
                                <button class="filter-tab" onclick="filterClients('offline')">Offline</button>
                            </div>
                            <ul class="client-list" id="clientList">
                                <div class="empty-state" style="padding: 40px 10px;">
                                    <div class="loading"></div>
                                    <p style="margin-top: 15px; font-size: 12px;">Loading...</p>
                                </div>
                            </ul>
                        </div>

                        <!-- MIDDLE COLUMN: Proxy Management -->
                        <div class="clients-middle" id="proxyMiddle">
                            <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                                <p style="font-size: 48px; margin-bottom: 15px;">üåê</p>
                                <p>Select a client to manage proxies</p>
                            </div>
                        </div>

                        <!-- RIGHT COLUMN: Client Details & Controls -->
                        <div class="clients-right" id="clientRight">
                            <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                                <p style="font-size: 48px; margin-bottom: 15px;">üìã</p>
                                <p>Select a client to view details</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PROXY TAB -->
                <div class="content-section" id="proxySection">
                    <div class="section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üåê Proxy Management</h3>
                            <button class="btn btn-secondary" onclick="loadAllProxies()">üîÑ Refresh</button>
                        </div>
                        
                        <div id="allProxiesList" style="margin-top: 20px;">
                            <div style="text-align: center; padding: 40px; color: var(--text-light);">
                                Loading proxies...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- USERS TAB -->
                <div class="content-section" id="usersSection">
                    <div class="section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üë§ User Management</h3>
                            <button class="btn btn-primary" onclick="showAddUserForm()">‚ûï Add User</button>
                        </div>

                        <!-- Add User Form (hidden by default) -->
                        <div id="addUserForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="margin-bottom: 15px;">Create New User</h4>
                            <div style="display: grid; gap: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Username</label>
                                    <input type="text" id="newUsername" class="input-field" placeholder="Enter username" />
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Password</label>
                                    <input type="password" id="newPassword" class="input-field" placeholder="Enter password" />
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Full Name</label>
                                    <input type="text" id="newFullName" class="input-field" placeholder="Enter full name" />
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Role</label>
                                    <select id="newRole" class="input-field">
                                        <option value="admin">Admin</option>
                                        <option value="operator">Operator</option>
                                        <option value="viewer">Viewer</option>
                                    </select>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-primary" onclick="createUser()">Create User</button>
                                    <button class="btn btn-secondary" onclick="hideAddUserForm()">Cancel</button>
                                </div>
                            </div>
                        </div>

                        <!-- Edit User Form (hidden by default) -->
                        <div id="editUserForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="margin-bottom: 15px;">Edit User</h4>
                            <div style="display: grid; gap: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Username (Read-only)</label>
                                    <input type="text" id="editUsername" class="input-field" placeholder="Username" readonly style="background: #e9ecef; cursor: not-allowed;" />
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Full Name</label>
                                    <input type="text" id="editFullName" class="input-field" placeholder="Enter full name" />
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">New Password (leave empty to keep current)</label>
                                    <input type="password" id="editPassword" class="input-field" placeholder="Leave empty to keep current password" />
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Role</label>
                                    <select id="editRole" class="input-field">
                                        <option value="admin">Admin</option>
                                        <option value="operator">Operator</option>
                                        <option value="viewer">Viewer</option>
                                    </select>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-primary" onclick="saveUserEdit()">Save Changes</button>
                                    <button class="btn btn-secondary" onclick="hideEditUserForm()">Cancel</button>
                                </div>
                            </div>
                        </div>

                        <!-- Users Table -->
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Full Name</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-light);">Loading users...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div class="content-section" id="settingsSection">
                    <div class="section">
                        <h3>‚öôÔ∏è Client Update Paths</h3>
                        <p style="color: var(--text-light); margin-top: 10px; margin-bottom: 20px;">Configure platform-specific update paths. Use {version} as a placeholder for the client version.</p>
                        
                        <div class="settings-grid">
                            <div class="settings-item">
                                <label for="updatePathWindowsAmd64">Windows AMD64 (64-bit)</label>
                                <input type="url" id="updatePathWindowsAmd64" placeholder="https://example.com/clients/windows/amd64/" />
                            </div>
                            
                            <div class="settings-item">
                                <label for="updatePathWindows386">Windows 386 (32-bit)</label>
                                <input type="url" id="updatePathWindows386" placeholder="https://example.com/clients/windows/386/" />
                            </div>
                            
                            <div class="settings-item">
                                <label for="updatePathLinuxAmd64">Linux AMD64 (64-bit)</label>
                                <input type="url" id="updatePathLinuxAmd64" placeholder="https://example.com/clients/linux/amd64/" />
                            </div>
                            
                            <div class="settings-item">
                                <label for="updatePathLinux386">Linux 386 (32-bit)</label>
                                <input type="url" id="updatePathLinux386" placeholder="https://example.com/clients/linux/386/" />
                            </div>
                            
                            <div class="settings-item">
                                <label for="updatePathDarwinAmd64">macOS AMD64 (Intel)</label>
                                <input type="url" id="updatePathDarwinAmd64" placeholder="https://example.com/clients/darwin/amd64/" />
                            </div>
                            
                            <div class="settings-item">
                                <label for="updatePathDarwinArm64">macOS ARM64 (Apple Silicon)</label>
                                <input type="url" id="updatePathDarwinArm64" placeholder="https://example.com/clients/darwin/arm64/" />
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="saveUpdatePaths()">üíæ Save Settings</button>
                    </div>

                    <div class="section" style="margin-top: 30px;">
                        <h3>üì¢ Push Client Updates</h3>
                        <p style="color: var(--text-light); margin-top: 10px; margin-bottom: 20px;">Send update commands to clients by platform and version.</p>
                        
                        <div style="background: var(--light); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Select Platform</label>
                                    <select id="updatePlatform" class="input-field" style="padding: 10px; border: 1px solid var(--border); border-radius: 4px;">
                                        <option value="">-- Choose Platform --</option>
                                        <option value="windows-amd64">Windows AMD64</option>
                                        <option value="windows-386">Windows 386</option>
                                        <option value="linux-amd64">Linux AMD64</option>
                                        <option value="linux-386">Linux 386</option>
                                        <option value="darwin-amd64">macOS AMD64 (Intel)</option>
                                        <option value="darwin-arm64">macOS ARM64 (Apple Silicon)</option>
                                        <option value="all">All Platforms</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">New Version</label>
                                    <input type="text" id="updateVersion" class="input-field" placeholder="e.g., 2.0.0" style="padding: 10px; border: 1px solid var(--border); border-radius: 4px;" />
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Force Update</label>
                                    <select id="updateForce" class="input-field" style="padding: 10px; border: 1px solid var(--border); border-radius: 4px;">
                                        <option value="false">No (optional)</option>
                                        <option value="true">Yes (mandatory)</option>
                                    </select>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                                <button class="btn btn-primary" onclick="pushClientsUpdate()" style="width: 100%;">üì§ Push Update</button>
                                <button class="btn btn-secondary" onclick="clearUpdateForm()" style="width: 100%;">Clear</button>
                            </div>
                        </div>

                        <div id="updateStats" style="display: none; background: #f0f8ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--info); margin-bottom: 15px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <div style="font-size: 12px; color: var(--text-light); margin-bottom: 5px;">Total Matching</div>
                                    <div style="font-size: 24px; font-weight: 600; color: var(--info);" id="matchingCount">0</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: var(--text-light); margin-bottom: 5px;">Updates Sent</div>
                                    <div style="font-size: 24px; font-weight: 600; color: var(--success);" id="updatesSent">0</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: var(--text-light); margin-bottom: 5px;">Failed</div>
                                    <div style="font-size: 24px; font-weight: 600; color: var(--danger);" id="updatesFailed">0</div>
                                </div>
                            </div>
                        </div>

                        <div id="updateLogContainer" style="display: none;">
                            <h4 style="margin-bottom: 10px; font-size: 14px;">üìã Update Log</h4>
                            <div id="updateLog" style="background: #f5f5f5; padding: 15px; border-radius: 6px; font-size: 12px; max-height: 300px; overflow-y: auto; font-family: monospace; line-height: 1.5;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- MODALS -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="confirmTitle">Confirm Action</h3>
            <p id="confirmMessage"></p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmAction()">Confirm</button>
            </div>
        </div>
    </div>

    <div class="modal" id="statusModal">
        <div class="modal-content">
            <h3 id="statusTitle">Status</h3>
            <p id="statusMessage"></p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="/assets/js/dashboard-new.js"></script>
</body>
</html>
